<VirtualHost *:80>

    ServerAdmin webmaster@localhost
    DocumentRoot ${APACHE_DOCUMENTROOT}

    #LogLevel info warn

    ErrorLog /dev/stderr
    TransferLog /dev/stdout

    <Directory ${APACHE_DOCUMENTROOT}>
      Options +Indexes +FollowSymLinks
      AllowOverride All
      Require all granted
    </Directory>

    # QGIS server config

    # Longer timeout for WPS... default = 40
    FcgidIOTimeout 120
    FcgidInitialEnv LC_ALL "en_US.UTF-8"
    FcgidInitialEnv PYTHONIOENCODING UTF-8
    FcgidInitialEnv LANG "en_US.UTF-8"
    FcgidInitialEnv QGIS_DEBUG 3
    FcgidInitialEnv QGIS_SERVER_LOG_FILE ""
    FcgidInitialEnv QGIS_SERVER_LOG_STDERR 1
    FcgidInitialEnv QGIS_SERVER_LOG_LEVEL 0
    FcgidInitialEnv QGIS_SERVER_PARALLEL_RENDERING 1
    #FcgidInitialEnv QGIS_CUSTOM_CONFIG_PATH "/web/projects/"
    #FcgidInitialEnv QGIS_PLUGINPATH "/web/plugins"
    FcgidInitialEnv HOME "/var/www"
    # Pass display number to QGIS Server instances
    FcgidInitialEnv DISPLAY ":99"
    Header set Access-Control-Allow-Origin "*"

    # Needed for QGIS plugins auth
    <IfModule mod_fcgid.c>
        RewriteEngine on
        RewriteCond %{HTTP:Authorization} .
        RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
        FcgidConnectTimeout 20
        IdleTimeout 300
        BusyTimeout 300
        ProcessLifeTime 7200
        IPCConnectTimeout 300
        IPCCommTimeout 7200
    </IfModule>

    ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
    <Directory "/usr/lib/cgi-bin">
      AllowOverride All
      Options +ExecCGI -MultiViews +FollowSymLinks
      AddHandler fcgid-script .fcgi
      Require all granted
    </Directory>

</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
